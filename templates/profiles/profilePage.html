{% extends "base.html" %}
{% load static %}
{% block content %}
<div style="width: 80%;margin:auto;display:flex;flex-direction:column;align-items:center;">
    <div style="border-radius:4px;margin:auto;width: 100%;height:450px;">
        <img src="{{profile.background_image.url}}"
            style="border-radius:5px;max-height:100%; width:100%; background-image:url({{profile.background_image.url}});background-repeat: no-repeat; background-size: auto;background-position:center center;object-fit:cover;"
            alt="">
    </div>
    <div style="width: 100%;height:200px;display:flex;padding:5%;align-items:center;background-color:#fff;">
        <div style="width: 100%;display:flex;align-items:center;">
            <div style="width:200px;display:flex;flex-direction:column;align-items:center;">
                <img style="border-radius: 50%;width: 200px;height: 200px;margin-top:-100px;border:5px solid #fff;"
                    src="{{profile.avatar.url}}" alt="">
                <strong style="font-size: 34px;">{{profile.user.username}}</strong>
            </div>
        </div>

        <div class="follow_count" style="display:flex;gap:35px;">
            <div class="follow_count_count" style="display: flex;flex-direction:column;">
                <h3>Following</h3>
                <p>{{following_count}}</p>
            </div>
            <br>
            <div class="follow_count_count" style="display: flex;flex-direction:column;">
                <h3>Followers</h3>
                <p>{{profile.followed_by.all.count}}</p>
            </div>
            {% if profile.user == request.user %}
            <div>
                <a class="btn btn-warning rounded text-white" style="height:auto;width:50px;" href="{% url 'user_profile' %}">Edit</a>
            </div>
            {% else %}
            <div>
                <form method="post" action="">
                    {% csrf_token %}
                    {% if profile in user.profile.follows.all %}
                    <button name="follow" value="unfollow" class="btn btn-danger">Unfollow</button>
                    {% else %}
                    <button name="follow" value="follow" class="btn btn-success">Follow</button>
                    {% endif %}
                </form>
            </div>
            {% endif %}
        </div>
    </div>

    {% if profile.is_private is False or profile in user.profile.follows.all %}

    {% if profile.user == request.user %}
    <div hx-boost="true"
        style="height: 80px;width:100%;border-top:1px solid grey;display:flex;justify-content:center;gap:25px;">
        <a class="link1"  id="profile_page_link" href="{% url 'show-profile' profile.id  %}"
            style="height:25px;border:none;background-color:gray;border-radius:4px;margin-top:3px;text-decoration:none;color:#000;">Posts</a>
        <a class="link2"  href="{% url 'saved_posts' profile.id  %}"
            style="height:25px;border:none;background-color:lightgray;border-radius:4px;margin-top:3px;text-decoration:none;color:#000;">Saved</a>
    </div>
    {% else %}
    {% endif %}
    <div id="posts_showing" style="padding: 20px;text-align:center;width:100%;">
        <h2>Recent Posts</h2>
        <div class="profile-grid">
            {% for posts in posts %}
            {% if posts.image.url|slice:"-4:" == ".mp4" %}
            {% else %}
            <div class="postss" style="border-radius:5px;padding:1rem;box-shadow: rgba(0, 0, 0, 0.55) 0px 5px 15px;">
                <div style="display: flex;flex-direction:column;align-items:center;height: 100%;width:100%;">
                    <img class="img-fluid" style="border-radius: 5px;aspect-ratio:1/1;" width="400px" height="350px"
                        src="{{  posts.image.url  }}" alt="Image ">
                    <strong style="text-align: center;">{{posts.desription}}</strong>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% if profile.user == request.user %}
        <a hx-boost="true" href="{% url 'saved_posts' profile.id  %}">Saved Posts</a>
        {% else %}
        {% endif %}
    </div>
    {% else %}
    <div>
        <h2>Private Account</h2>
    </div>
    {% endif %}
</div>
{% endblock %}